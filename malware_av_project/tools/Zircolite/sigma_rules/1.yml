title: WannaCry Ransomware Behavior - High Confidence
id: 1e8f3b4a-9c7d-4c5f-8a2b-0f9e6d5c4b3a
status: experimental
description: >-
  Detects high-confidence behavioral indicators of WannaCry ransomware,
  including process creation patterns, ransom file drops, and GUI ransom note display.
  Based on lab analysis of 1-WannaCrypt0r.exe and related artifacts.
author: Generated for detection based on lab analysis
date: 2025/11/05
references:
  - https://en.wikipedia.org/wiki/WannaCry_ransomware
  - Internal Lab Analysis Report - 2314003 Tan Shiyang
logsource:
  category: process_creation
  product: windows
  service: sysmon
detection:
  # 检测已知的 WannaCry 相关进程文件名
  selection_image:
    Image|endswith:
      - '\1-WannaCrypt0r.exe'
      - '\@WanaDecryptor@.exe'
      - '\tasksche.exe'
      - '\cmd.exe'  # 常用于执行勒索相关命令
      - '\conhost.exe'  # 伴随 cmd 出现
  # 检测命令行中出现的 WannaCry 特有字符串
  selection_cmdline:
    CommandLine|contains:
      - 't.wmry'
      - 'WanaDecryptor'
      - 'tasksche.exe'
      - '@WanaDecryptor@.exe'
  # 检测父进程为 tasksche.exe（WannaCry 常用计划任务启动）
  selection_parent:
    ParentImage|endswith:
      - '\tasksche.exe'
  # 检测勒索信息文件创建行为
  selection_ransom_note:
    Image|endswith: '\cmd.exe'
    CommandLine|contains: '.WNCRYT'
  # 检测进程终止行为：WannaCry 会启动并终止多个进程，最终留下自身
  selection_process_termination:
    Image|endswith: '\1-WannaCrypt0r.exe'
    CommandLine|contains: 'terminate'
  # 组合条件：满足任意一项即触发
  condition: 
    any of selection_*
falsepositives:
  - Legitimate use of tasksche.exe in system administration
  - Security research or lab environments analyzing WannaCry samples
  - Penetration testing tools using similar command patterns
level: critical
tags:
  - attack.impact
  - attack.t1490
  - ransomware.wannacry
  - persistence.scheduled_task