import "pe"
rule WannaCrpt0r {
    strings:
        $s1 = "This program cannot be run in DOS mode" wide
        $s2 = "t.wnry"
        $s3 = "cmd.exe" wide
        $s4 = "WARNING_THIS_WILL_DESTROY_YOUR_MACHINE"
        $s5 = "WannaCrypt" nocase
        $s6 = "tasksche.exe"
        $s7 = "attrib +h"
        $s8 = "icacls"

    condition:
        uint16(0) == 0x5A4D and
        filesize < 10MB and
        pe.number_of_sections >= 3 and
        ( 
            (4 of ($s1, $s2, $s3, $s4, $s5, $s6, $s7, $s8)) or
            (2 of ($s2, $s5) and 3 of ($s*)) or
            (pe.imports("ADVAPI32.dll", "CreateServiceA") and 3 of ($s*))
        )
}
