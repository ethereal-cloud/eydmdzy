import "pe"
rule BUG32{
    strings:
        $s1 = "SHGetPathFromIDList" wide ascii
        $s2 = "SHBrowseForFolder" wide ascii
        $s3 = "stack overflow" wide ascii
        $s4 = "integer overflow" wide ascii
        $s5 = "Division" wide ascii
        $s6 = "CreateProcess" wide ascii
        $s7 = "ShellExecute" wide ascii
        $s8 = "RegCreateKey" wide ascii
    
    condition:
        uint16(0) == 0x5A4D and  
        pe.number_of_sections >= 3 and
        pe.imports("SHELL32.dll") and
        pe.imports("KERNEL32.dll") and
        5 of them
}