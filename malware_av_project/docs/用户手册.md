# 课程杀毒软件（YARA + Sigma）用户手册

本项目面向课程大作业：基于自编写的 **YARA 规则** 和 **Sigma 规则**，完成对课程样本与额外样本的检测，并输出准确率、误报率等指标。

> 注意：Sigma 主要用于**日志检测**（如 Sysmon/Windows 事件日志导出），本项目提供一个 **离线 JSONL 日志扫描** 的最小可用实现，便于课程验收。

## 1. 环境要求
- Windows 10/11（或 Linux/Mac 亦可）
- Python 3.10+（建议 3.11）

## 2. 安装
在项目根目录打开 PowerShell / 终端：

```bash
python -m venv .venv
.\.venv\Scripts\activate
pip install -r requirements.txt
```

## 3. 放置规则
### 3.1 YARA
把 `.yar/.yara` 放到 `rules/yara/`（支持子目录递归加载）

### 3.2 Sigma（可选）
把 `.yml/.yaml` 放到 `rules/sigma/`（支持子目录递归加载）

## 4. 扫描文件（YARA）
扫描目录（课程样本 / virusshare 样本）：

```bash
python avscan.py scan --input samples/course --yara rules/yara --hash --out outputs/course_report.json
```

## 5. 扫描日志（Sigma，可选）
准备 JSONL 日志（每行一个 JSON 事件），然后：

```bash
python avscan.py scan --input samples/course --yara rules/yara --sigma rules/sigma --logs samples/logs/events.jsonl --out outputs/report_with_sigma.json
```

## 6. 计算准确率/误报率
准备 `samples/groundtruth.csv`（示例已给），然后：

```bash
python avscan.py metrics --report outputs/course_report.json --groundtruth samples/groundtruth.csv
```

## 7. 常见问题
- 报错 `No YARA rule files found`：确认 `rules/yara/` 下有规则文件
- Sigma 不生效：本项目实现的是最小子集，复杂 condition 建议先裁剪到课程可验收版本
